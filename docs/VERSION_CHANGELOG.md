# 版本变更说明

## v1.1.3 - 功能增强与bug修复

### 新增功能

1. **浏览器出口IP显示**
   - 在登录页面右下角添加了IP显示功能
   - 点击小眼睛图标可显示/隐藏浏览器出口IP
   - 提升了用户对登录环境的感知

2. **企业微信webhook通知**
   - 实现了系统异常和API调用失败时的企微通知
   - 支持info、warning、error三个消息级别
   - 包含详细错误信息和时间戳
   - 支持关键异常位置自动发送通知

3. **密码修改优化**
   - 企业微信登录用户修改密码无需验证原密码
   - 密码修改成功后自动跳转用户中心
   - 增强了密码强度验证

### 修复内容

1. **浏览器识别修复**
   - 修复了Edge浏览器被错误识别为Chrome的问题
   - 调整了浏览器识别顺序，优先识别Edge
   - 增强了浏览器信息提取的准确性

2. **登录问题修复**
   - 修复了开发环境下非admin用户登录失败的问题
   - 优化了登录逻辑，支持多种登录方式
   - 增强了登录日志记录的完整性

3. **密码修改流程修复**
   - 修复了密码修改后不自动跳转的问题
   - 优化了密码修改页面的用户体验

### 优化内容

1. **开发环境优化**
   - 开发环境支持多种登录方式
   - 优化了开发环境的调试信息输出
   - 增强了开发环境的容错能力

2. **浏览器信息增强**
   - 精确识别浏览器类型和版本
   - 优化了浏览器信息的提取逻辑
   - 支持更多浏览器类型

3. **安全增强**
   - 增强了密码修改的安全性
   - 优化了登录验证的安全性
   - 增强了系统异常监控

## v1.1.2 - 项目清理与文档更新

### 项目清理

1. **移除临时代码**
   - 删除了项目根目录下所有临时测试脚本
   - 清理了不再需要的数据库检查脚本
   - 遵循项目规范，确保代码结构清晰

## v1.1.1 - 项目文档更新

### 文档更新

1. **README.md 更新**
   - 添加了登录日志功能的详细说明
   - 更新了项目目录结构，移除了过时的JSON数据存储说明
   - 增强了安全注意事项，添加了企业微信IP白名单配置要求
   - 更新了数据模型模块说明，包含登录日志模型

2. **CONFIG_DEPLOYMENT_GUIDE.md 更新**
   - 更新了必需配置项，添加了PERMANENT_SESSION_LIFETIME配置
   - 修正了回调地址协议为HTTPS
   - 添加了登录日志记录异常的排查建议
   - 增强了注意事项部分

3. **WECHAT_CORP_CONFIG_GUIDE.md 更新**
   - 扩展了测试模式使用说明
   - 添加了解决IP访问受限问题（错误码60020）的方法
   - 详细说明了测试模式的工作原理和适用场景

### 兼容性说明

- 本版本仅包含文档更新，不涉及代码变更
- 与之前版本完全兼容
- 所有现有功能保持不变

## v1.1.0 - 登录日志功能实现

### 新增功能

1. **登录日志记录功能**
   - 添加了 `LoginLog` 数据库模型，用于记录所有登录尝试
   - 记录关键信息：用户名、IP地址、登录状态、错误信息、时间戳
   - 支持多种失败场景的日志记录：验证码错误、密码错误、用户不存在

### 优化内容

1. **文件目录结构优化**
   - 将临时测试脚本从项目根目录移动到 `tests/integration` 目录
   - 遵循项目规范，提高代码组织性

2. **测试脚本增强**
   - 创建了全面的登录场景测试
   - 支持多个测试场景：错误验证码、错误密码、正确凭证、不存在用户
   - 优化了测试环境配置，确保测试可靠性

### 安全性提升

1. **登录日志安全**
   - 遵循安全规范，日志中不记录敏感信息（如密码）
   - 提供完整的登录审计能力，方便安全监控

### 修改的文件

- `app/models/db.py` - 添加 LoginLog 模型
- `app/routes/auth.py` - 增强登录功能，添加日志记录
- `app/models/__init__.py` - 更新模型导出配置
- 测试脚本位置优化：移动到 tests/integration 目录

### 兼容性说明

- 本版本与之前版本完全兼容
- 无需修改现有数据库结构，会自动创建新的 login_log 表
- 所有现有功能保持不变，仅增强了日志记录能力